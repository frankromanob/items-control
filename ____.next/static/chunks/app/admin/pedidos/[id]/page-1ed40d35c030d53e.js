(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[246],{91122:function(e,t,a){"use strict";var r=a(38173),s=a(57437);t.Z=(0,r.Z)((0,s.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM8 9h8v10H8V9zm7.5-5-1-1h-5l-1 1H5v2h14V4z"}),"DeleteOutline")},76712:function(e,t,a){"use strict";var r=a(38173),s=a(57437);t.Z=(0,r.Z)((0,s.jsx)("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm2 16H5V5h11.17L19 7.83V19zm-7-7c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3zM6 6h9v4H6z"}),"SaveOutlined")},25646:function(e,t,a){Promise.resolve().then(a.bind(a,29899)),Promise.resolve().then(a.bind(a,85384))},86447:function(e,t,a){"use strict";var r=a(92173);let s=r.Z.create({baseURL:"".concat("http://localhost:3000","/api")});t.Z=s},85384:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return w}});var r=a(57437),s=a(2265),o=a(38173),i=(0,o.Z)((0,r.jsx)("path",{d:"M7 11v2h10v-2H7zm5-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"RemoveCircleOutlineOutlined"),l=(0,o.Z)((0,r.jsx)("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h10v-2H4v-6h18V6c0-1.11-.89-2-2-2zm0 4H4V6h16v2zm4 9v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3z"}),"AddCardOutlined"),d=a(91122),n=a(76712),c=(0,o.Z)((0,r.jsx)("path",{d:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67 2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"}),"SaveAltOutlined"),u=a(85269),m=a(38939),x=a(67248),h=a(64494),p=a(65984),f=a(76182),y=a(54986),j=a(61865),Z=a(49600),v=a(96507),g=a(24033),b=a(41277),C=a(86447);function w(e){let{order:t}=e,{register:a,handleSubmit:o,formState:{errors:w},getValues:S,setValue:E,watch:P}=(0,j.cI)({defaultValues:t}),[N,_]=(0,s.useState)(void 0),[z,O]=(0,s.useState)(void 0),[V,I]=(0,s.useState)(t.orderItems),[q,D]=(0,s.useState)({product:"",title:"",quantity:0}),[H,T]=(0,s.useState)(!1),[k,M]=(0,s.useState)(!1),[L,A]=(0,s.useState)(!1),K=(0,g.useRouter)(),R=[{field:"productName",headerName:"Producto",width:300},{field:"quantity",headerName:"Cantidad",width:80},{field:"product",headerName:"Eliminar",width:100,align:"center",headerAlign:"center",renderCell:e=>{let{row:t}=e;return(0,r.jsx)(Z.Z,{color:"error",startIcon:(0,r.jsx)(i,{}),disabled:"Completado"==S("status"),onClick:()=>B(t),sx:{ml:1,width:"20px",justifyItems:"center"}})}}];(0,s.useEffect)(()=>{let e=async()=>{let{data:e}=await (0,C.Z)("/products");_(e)};e()},[]),(0,s.useEffect)(()=>{N&&M(!0)},[N]),(0,s.useEffect)(()=>{let e=async()=>{let{data:e}=await (0,C.Z)("/customers");O(e)};e()},[]),(0,s.useEffect)(()=>{z&&A(!0)},[z]);let W=async e=>{T(!0);try{e.orderItems=V,e.status="En proceso";let t=await (0,C.Z)("/orders",{method:e._id?"PUT":"POST",data:JSON.stringify(e)});if(T(!1),"OK"!==t.statusText)throw Error(t.statusText);alert("Pedido guardado correctamente."),K.replace("/admin/pedidos/".concat(t.data._id))}catch(e){T(!1),alert("Ha ocurrido un error. "+e),console.log(e)}},J=async e=>{T(!0);try{e.orderItems=V,e.status="Completado";let t=await (0,C.Z)("/orders",{method:"PUT",data:JSON.stringify(e)});if(T(!1),"OK"!==t.statusText)throw Error(t.statusText);alert("Pedido procesado correctamente."),K.replace("/pedidos"),K.refresh()}catch(e){T(!1),alert("Ha ocurrido un error. "+e),console.log(e)}},U=async e=>{try{let t=await (0,C.Z)("/orders",{method:"DELETE",data:JSON.stringify(e)});if("OK"!==t.statusText&&"OK"!==t.statusText)throw Error(t.statusText);alert("Pedido eliminado correctamente. Nota: esto no afecta la existencia"),K.replace("/pedidos"),K.refresh()}catch(e){T(!1),console.log(e)}},G=async()=>{if(""==q.product||q.quantity<1){alert("Debe especificar el producto y la cantidad correcta");return}let e=N.filter(e=>e._id==q.product);I([...V,{id:e[0]._id+new Date,product:e[0]._id,productName:e[0].title,productSlug:e[0].slug,productImage:e[0].images[0],quantity:q.quantity,status:"En proceso"}]),D({product:"",title:"",quantity:0})},F=e=>{let t=N.filter(t=>t._id==e.target.value);D({...q,product:t[0]._id,title:t[0].title})},$=e=>{let t=z.filter(t=>t._id==e);E("customer",t[0]._id,{shouldValidate:!0}),E("customerName",t[0].firstName+" "+t[0].lastName,{shouldValidate:!0}),E("customerEmail",t[0].email,{shouldValidate:!0}),E("customerPhone",t[0].phone,{shouldValidate:!0})},B=e=>{let t=V.filter(t=>t.id!=e.id);I(t)},Q=V.map(e=>({id:e.id,productName:e.productName,product:e.product,productSlug:e.productSlug,quantity:e.quantity,status:e.status}));return k?L?(0,r.jsx)(v.Z,{sx:{display:"flex",flexDirection:"column"},children:(0,r.jsx)("form",{name:"entryForm",onSubmit:o(W),children:(0,r.jsx)(m.ZP,{container:!0,spacing:2,mt:1,children:(0,r.jsxs)(m.ZP,{item:!0,xs:12,children:[(0,r.jsxs)(v.Z,{sx:{display:"flex",flexDirection:"column",mb:1},children:[(0,r.jsxs)(v.Z,{sx:{display:"flex",flexDirection:"column",mb:1},children:[(0,r.jsx)(x.Z,{select:!0,id:"customer",defaultValue:t.customer,label:"Cliente",disabled:"Completado"==S("status"),...a("customer",{required:"Este campo es requerido"}),error:!!w.customer,helperText:"Seleccione el cliente de este pedido",onChange:e=>$(e.target.value),sx:{ml:1,mb:2},children:z.map(e=>(0,r.jsx)(h.Z,{value:e._id,sx:{display:"flex",flexDirection:"row"},children:e.firstName+" "+e.lastName},e._id))}),(0,r.jsx)(x.Z,{label:"Correo",variant:"outlined",autoComplete:"false",id:"email",value:S("customerEmail"),name:"email",sx:{ml:1,mb:1},...a("customerEmail")})]}),(0,r.jsxs)(v.Z,{sx:{display:"flex",flexDirection:"row",mb:1},children:[(0,r.jsx)(x.Z,{label:"Telefono",variant:"outlined",autoComplete:"false",id:"phone",fullWidth:!0,value:S("customerPhone"),name:"phone",sx:{mb:1,ml:1},...a("customerPhone")}),(0,r.jsx)(x.Z,{label:"Estado",variant:"outlined",autoComplete:"false",id:"status",name:"status",value:S("status"),sx:{mb:1,ml:2},...a("status",{}),error:!!w.status})]})]}),(0,r.jsxs)(v.Z,{sx:{display:"flex",flexDirection:"column",boxShadow:2,border:1,borderRadius:2,borderColor:"teal",ml:1},children:[(0,r.jsx)(u.Z,{sx:{m:1},color:"secondary",children:"Agregar productos"}),(0,r.jsx)(p.Z,{}),(0,r.jsxs)(v.Z,{sx:{display:"flex",flexDirection:"row",justifyContent:"space-evenly"},children:[(0,r.jsx)(x.Z,{select:!0,disabled:"Completado"==S("status"),id:"Producto",fullWidth:!0,value:q.product,name:"product",SelectProps:{renderValue:e=>q.title},helperText:"Seleccione el producto a agregar",onChange:e=>F(e),sx:{m:1},children:N.map(e=>(0,r.jsxs)(h.Z,{value:e._id,sx:{display:"flex",flexDirection:"row",flex:"wrap"},children:[(0,r.jsx)(v.Z,{sx:{width:"20px",mr:1},children:(0,r.jsx)(f.Z,{component:"img",image:e.images[0],alt:e.title})}),e.title," - ",e.inStock]},e._id))}),(0,r.jsx)(x.Z,{label:"Cantidad",variant:"outlined",disabled:"Completado"==S("status"),type:"number",value:q.quantity,onChange:e=>D({...q,quantity:Number(e.target.value)}),autoComplete:"false",id:"quantity",name:"quantity",InputProps:{inputProps:{min:0,max:99}},sx:{m:1,width:"110px"}})]}),(0,r.jsx)(v.Z,{sx:{display:"flex",justifyContent:"flex-end"},children:(0,r.jsx)(Z.Z,{color:"secondary",startIcon:(0,r.jsx)(l,{}),disabled:"Completado"==S("status"),sx:{m:1,width:"150px",height:"30px"},onClick:()=>G(),children:"Agregar"})})]}),(0,r.jsx)(y.Z,{sx:{m:1}}),(0,r.jsx)(m.ZP,{container:!0,className:"fadeIn",children:(0,r.jsx)(m.ZP,{item:!0,lg:12,xs:12,sx:{height:300,width:"100%"},children:(0,r.jsx)(b._$,{sx:{boxShadow:2,border:1,borderColor:"teal",color:"secondary.main","& .MuiDataGrid-cell:hover":{color:"primary.main"},ml:1},rows:Q,columns:R,autoPageSize:!0})})}),(0,r.jsx)(y.Z,{sx:{m:1}}),(0,r.jsxs)(v.Z,{display:"flex",flexDirection:"row",justifyContent:"space-between",sx:{m:1},children:[(0,r.jsx)(Z.Z,{color:"error",startIcon:(0,r.jsx)(d.Z,{}),sx:{width:"100px",height:"30px",ml:1,mt:1},type:"button",onClick:()=>U(S("_id")),children:"Eliminar"}),(0,r.jsx)(Z.Z,{color:"secondary",startIcon:(0,r.jsx)(n.Z,{}),sx:{width:"100px",height:"30px",m:1},type:"submit",disabled:H||"Completado"==S("status"),children:"Guardar"}),(0,r.jsx)(Z.Z,{color:"primary",startIcon:(0,r.jsx)(c,{}),sx:{width:"160px",height:"30px",mt:1},onClick:()=>J(t),disabled:H||"En proceso"!==S("status"),children:"Procesar pedido"})]})]})})})}):(0,r.jsx)(u.Z,{marginInlineStart:"5px",fontWeight:"bold",color:"secondary",children:"Cargando clientes..."}):(0,r.jsx)(u.Z,{marginInlineStart:"5px",fontWeight:"bold",color:"secondary",children:"Cargando productos..."})}}},function(e){e.O(0,[869,899,277,604,971,472,744],function(){return e(e.s=25646)}),_N_E=e.O()}]);