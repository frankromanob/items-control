"use strict";(()=>{var e={};e.id=39,e.ids=[39],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},57403:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>y,originalPathname:()=>v,patchFetch:()=>S,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m,staticGenerationBailout:()=>f});var n={};a.r(n),a.d(n,{GET:()=>u});var r=a(10884),i=a(16132),o=a(21040),s=a(25999),d=a(59471),c=a(11185);async function u(e,{params:t}){let{slug:a}=t,n=null;(0,c.isValidObjectId)(a)&&(n=a),await s.db.connect();let r=await d.Z.findOne({$or:[{slug:a},{_id:n}]}).lean();return(await s.db.disconnect(),r)?(r.images=r.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),Response.json(r)):Response.json({message:"Producto no encontrado"})}let l=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/products/[slug]/route",pathname:"/api/products/[slug]",filename:"route",bundlePath:"app/api/products/[slug]/route"},resolvedPagePath:"/Users/altice/RomApps/items-control/src/app/api/products/[slug]/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g,headerHooks:y,staticGenerationBailout:f}=l,v="/api/products/[slug]/route";function S(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},25999:(e,t,a)=>{a.d(t,{db:()=>n,rx:()=>i,N2:()=>r});var n={};a.r(n),a.d(n,{connect:()=>c,disconnect:()=>u});var r={};a.r(r),a.d(r,{i:()=>m});var i={};a.r(i),a.d(i,{decreaseProductQuantity:()=>v,getAllProducts:()=>y,getProductBySlug:()=>f,increaseProductQuantity:()=>S});var o=a(11185),s=a.n(o);let d={isConnected:0},c=async()=>{if(!d.isConnected){if(s().connections.length>0){if(d.isConnected=s().connections[0].readyState,1===d.isConnected)return;await s().disconnect()}await s().connect(process.env.MONGO_URL||""),d.isConnected=1,console.log("Conectado a MongoDB:",process.env.MONGO_URL)}},u=async()=>{0!==d.isConnected&&(await s().disconnect(),d.isConnected=0)};var l=a(62421),p=a.n(l);let m={users:[{name:"Francisco Romano",email:"fromano@google.com",password:p().hashSync("123456"),role:"admin"},{name:"Betilio Romano",email:"bromano@google.com",password:p().hashSync("654321"),role:"client"}]};a(90644);var g=a(59471);let y=async()=>{await c();let e=await g.Z.find().select(" -_id").lean();await u();let t=e.map(e=>(e.images=e.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),e));return JSON.parse(JSON.stringify(t))},f=async e=>{await c();let t=await g.Z.findOne({slug:e}).lean();return(await u(),t)?(t.images=t.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),JSON.parse(JSON.stringify(t))):null},v=async e=>{await c();try{e.map(async(e,t)=>{let a=await g.Z.findById({_id:e.product});a&&(a.inStock-=Number(e.quantity)),await a.save({validateBeforeSave:!0})})}catch(e){return console.log(e),new Response("Error al rebajar inventario",{status:500})}await u()},S=async(e,t)=>{await c();try{let a=await g.Z.findById({_id:e});a&&(a.inStock+=Number(t),await a.save({validateBeforeSave:!0}))}catch(e){return console.log(e),new Response("Error al incrementar inventario",{status:500})}await u()}},90644:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(11185),r=a.n(n);let i=new n.Schema({firstName:{type:String,required:!0,default:""},lastName:{type:String,required:!0,default:""},phone:{type:String,required:!0,default:""},email:{type:String,default:""}},{timestamps:!0});i.index({firstName:"text",email:"text"});let o=r().models.Customers||(0,n.model)("Customers",i),s=o},59471:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(11185),r=a.n(n);let i=new n.Schema({description:{type:String,default:""},images:[{type:String}],default:["",""],inStock:{type:Number,default:0},costo:{type:Number,required:!0,default:0},pv:{type:Number,default:0},bv:{type:Number,default:0},ibo:{type:Number,default:0},slug:{type:String,required:!0,default:"",unique:!0},tags:[{type:String,default:["",""]}],title:{type:String,required:!0},type:{type:String,default:""},sizes:{type:String,default:""}},{timestamps:!0});i.index({title:"text",tags:"text",slug:"text"});let o=r().models.Product||(0,n.model)("Product",i),s=o}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[271,444],()=>a(57403));module.exports=n})();