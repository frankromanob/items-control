"use strict";(()=>{var e={};e.id=146,e.ids=[146],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},56937:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>S,originalPathname:()=>b,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>y,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>v});var a={};r.r(a),r.d(a,{DELETE:()=>m,GET:()=>u,POST:()=>l,PUT:()=>p});var n=r(10884),o=r(16132),i=r(21040),s=r(25999),d=r(38562),c=r(11185);async function u(){await s.db.connect();let e=await d.Z.find().sort({title:"asc"}).lean();return await s.db.disconnect(),Response.json(e)}async function l(e){let t=await e.json(),{id:r="",customer:a="",customerName:n="",customerEmail:o="",customerPhone:i="",status:c="",orderItems:u={}}=t;await s.db.connect();let l=new d.Z({customer:a,customerName:n,customerEmail:o,customerPhone:i,status:c,orderItems:u});try{await l.save({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(l)}async function p(e){let t=await e.json(),{_id:r="",customer:a="",customerName:n="",customerEmail:o="",customerPhone:i="",status:u="",orderItems:l}=t;if(!(0,c.isValidObjectId)(r))return console.log("Id incorrecto"),new Response("Id del pedido incorrecto",{status:400});await s.db.connect();let p=await d.Z.findById({_id:r});if(!p)return await s.db.disconnect(),console.log("El pedido no existe"),new Response("El pedido no existe",{status:400});if("Completado"==u)try{s.rx.decreaseProductQuantity(l)}catch(e){return console.log(e),new Response("Error al rebajar inventario",{status:500})}p.customer=a,p.customerName=n,p.customerPhone=i,p.customerEmail=o,p.status=u,p.orderItems=l;try{await p.save({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(p)}async function m(e){let t=await e.json();if(!(0,c.isValidObjectId)(t))return console.log("Id incorrecto"),new Response("Id de pedido incorrecto",{status:400});await s.db.connect();let r=await d.Z.findById({_id:t});if(!r)return await s.db.disconnect(),console.log("El pedido no existe"),new Response("El pedido no existe",{status:400});try{await r.deleteOne({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(r)}let y=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/orders/route",pathname:"/api/orders",filename:"route",bundlePath:"app/api/orders/route"},resolvedPagePath:"/Users/altice/RomApps/items-control/src/app/api/orders/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:g,staticGenerationAsyncStorage:w,serverHooks:f,headerHooks:S,staticGenerationBailout:v}=y,b="/api/orders/route";function h(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:w})}},25999:(e,t,r)=>{r.d(t,{db:()=>a,rx:()=>o,N2:()=>n});var a={};r.r(a),r.d(a,{connect:()=>c,disconnect:()=>u});var n={};r.r(n),r.d(n,{i:()=>m});var o={};r.r(o),r.d(o,{decreaseProductQuantity:()=>f,getAllProducts:()=>g,getProductBySlug:()=>w,increaseProductQuantity:()=>S});var i=r(11185),s=r.n(i);let d={isConnected:0},c=async()=>{if(!d.isConnected){if(s().connections.length>0){if(d.isConnected=s().connections[0].readyState,1===d.isConnected)return;await s().disconnect()}await s().connect(process.env.MONGO_URL||""),d.isConnected=1,console.log("Conectado a MongoDB:",process.env.MONGO_URL)}},u=async()=>{0!==d.isConnected&&(await s().disconnect(),d.isConnected=0)};var l=r(62421),p=r.n(l);let m={users:[{name:"Francisco Romano",email:"fromano@google.com",password:p().hashSync("123456"),role:"admin"},{name:"Betilio Romano",email:"bromano@google.com",password:p().hashSync("654321"),role:"client"}]};r(90644);var y=r(59471);let g=async()=>{await c();let e=await y.Z.find().select(" -_id").lean();await u();let t=e.map(e=>(e.images=e.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),e));return JSON.parse(JSON.stringify(t))},w=async e=>{await c();let t=await y.Z.findOne({slug:e}).lean();return(await u(),t)?(t.images=t.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),JSON.parse(JSON.stringify(t))):null},f=async e=>{await c();try{e.map(async(e,t)=>{let r=await y.Z.findById({_id:e.product});r&&(r.inStock-=Number(e.quantity)),await r.save({validateBeforeSave:!0})})}catch(e){return console.log(e),new Response("Error al rebajar inventario",{status:500})}await u()},S=async(e,t)=>{await c();try{let r=await y.Z.findById({_id:e});r&&(r.inStock+=Number(t),await r.save({validateBeforeSave:!0}))}catch(e){return console.log(e),new Response("Error al incrementar inventario",{status:500})}await u()}},90644:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(11185),n=r.n(a);let o=new a.Schema({firstName:{type:String,required:!0,default:""},lastName:{type:String,required:!0,default:""},phone:{type:String,required:!0,default:""},email:{type:String,default:""}},{timestamps:!0});o.index({firstName:"text",email:"text"});let i=n().models.Customers||(0,a.model)("Customers",o),s=i},38562:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(11185),n=r.n(a);let o=new a.Schema({customer:{type:String,required:!0},customerName:{type:String,required:!0},customerEmail:{type:String,required:!0},customerPhone:{type:String,required:!0},orderItems:[{id:{type:String,required:!0},quantity:{type:Number,required:!0},status:{type:String,required:!0},product:{type:String,required:!0},productName:{type:String,required:!0},productImage:{type:String,required:!0},productSlug:{type:String,required:!0}},{timestamps:!0}],status:{type:String}},{timestamps:!0}),i=n().models.Order||(0,a.model)("Order",o),s=i},59471:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(11185),n=r.n(a);let o=new a.Schema({description:{type:String,default:""},images:[{type:String}],default:["",""],inStock:{type:Number,default:0},costo:{type:Number,required:!0,default:0},pv:{type:Number,default:0},bv:{type:Number,default:0},ibo:{type:Number,default:0},slug:{type:String,required:!0,default:"",unique:!0},tags:[{type:String,default:["",""]}],title:{type:String,required:!0},type:{type:String,default:""},sizes:{type:String,default:""}},{timestamps:!0});o.index({title:"text",tags:"text",slug:"text"});let i=n().models.Product||(0,a.model)("Product",o),s=i}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[271,444],()=>r(56937));module.exports=a})();