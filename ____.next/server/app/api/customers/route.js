"use strict";(()=>{var e={};e.id=636,e.ids=[636],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},62390:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>v,originalPathname:()=>b,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>w,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>S});var n={};a.r(n),a.d(n,{DELETE:()=>m,GET:()=>d,POST:()=>u,PUT:()=>p});var r=a(10884),o=a(16132),i=a(21040),s=a(25999),c=a(90644),l=a(11185);async function d(){await s.db.connect();let e=await c.Z.find().sort({title:"asc"}).lean();return await s.db.disconnect(),Response.json(e)}async function u(e){let t=await e.json(),{id:a="",firstName:n="",lastName:r="",email:o="",phone:i=""}=t;await s.db.connect();let l=await c.Z.findOne({email:o});if(l)return await s.db.disconnect(),console.log("El correo ya existe"),new Response("El correo ya existe",{status:400});let d=new c.Z({email:o.toLocaleLowerCase(),firstName:n,lastName:r,phone:i});try{await d.save({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(d)}async function p(e){let t=await e.json(),{_id:a="",firstName:n="",lastName:r="",email:o="",phone:i=""}=t;if(!(0,l.isValidObjectId)(a))return console.log("Id incorrecto"),new Response("Id de cliente incorrecto",{status:400});await s.db.connect();let d=await c.Z.findById({_id:a});if(!d)return await s.db.disconnect(),console.log("El cliente no existe"),new Response("El cliente no existe",{status:400});d.email=o,d.firstName=n,d.lastName=r,d.phone=i;try{await d.save({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(d)}async function m(e){let t=await e.json();if(!(0,l.isValidObjectId)(t))return console.log("Id incorrecto"),new Response("Id de cliente incorrecto",{status:400});await s.db.connect();let a=await c.Z.findById({_id:t});if(!a)return await s.db.disconnect(),console.log("El cliente no existe"),new Response("El cliente no existe",{status:400});try{await a.deleteOne({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(a)}let w=new r.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/customers/route",pathname:"/api/customers",filename:"route",bundlePath:"app/api/customers/route"},resolvedPagePath:"/Users/altice/RomApps/items-control/src/app/api/customers/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:g,headerHooks:v,staticGenerationBailout:S}=w,b="/api/customers/route";function h(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},25999:(e,t,a)=>{a.d(t,{db:()=>n,rx:()=>o,N2:()=>r});var n={};a.r(n),a.d(n,{connect:()=>l,disconnect:()=>d});var r={};a.r(r),a.d(r,{i:()=>m});var o={};a.r(o),a.d(o,{decreaseProductQuantity:()=>g,getAllProducts:()=>y,getProductBySlug:()=>f,increaseProductQuantity:()=>v});var i=a(11185),s=a.n(i);let c={isConnected:0},l=async()=>{if(!c.isConnected){if(s().connections.length>0){if(c.isConnected=s().connections[0].readyState,1===c.isConnected)return;await s().disconnect()}await s().connect(process.env.MONGO_URL||""),c.isConnected=1,console.log("Conectado a MongoDB:",process.env.MONGO_URL)}},d=async()=>{0!==c.isConnected&&(await s().disconnect(),c.isConnected=0)};var u=a(62421),p=a.n(u);let m={users:[{name:"Francisco Romano",email:"fromano@google.com",password:p().hashSync("123456"),role:"admin"},{name:"Betilio Romano",email:"bromano@google.com",password:p().hashSync("654321"),role:"client"}]};a(90644);var w=a(59471);let y=async()=>{await l();let e=await w.Z.find().select(" -_id").lean();await d();let t=e.map(e=>(e.images=e.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),e));return JSON.parse(JSON.stringify(t))},f=async e=>{await l();let t=await w.Z.findOne({slug:e}).lean();return(await d(),t)?(t.images=t.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),JSON.parse(JSON.stringify(t))):null},g=async e=>{await l();try{e.map(async(e,t)=>{let a=await w.Z.findById({_id:e.product});a&&(a.inStock-=Number(e.quantity)),await a.save({validateBeforeSave:!0})})}catch(e){return console.log(e),new Response("Error al rebajar inventario",{status:500})}await d()},v=async(e,t)=>{await l();try{let a=await w.Z.findById({_id:e});a&&(a.inStock+=Number(t),await a.save({validateBeforeSave:!0}))}catch(e){return console.log(e),new Response("Error al incrementar inventario",{status:500})}await d()}},90644:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(11185),r=a.n(n);let o=new n.Schema({firstName:{type:String,required:!0,default:""},lastName:{type:String,required:!0,default:""},phone:{type:String,required:!0,default:""},email:{type:String,default:""}},{timestamps:!0});o.index({firstName:"text",email:"text"});let i=r().models.Customers||(0,n.model)("Customers",o),s=i},59471:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(11185),r=a.n(n);let o=new n.Schema({description:{type:String,default:""},images:[{type:String}],default:["",""],inStock:{type:Number,default:0},costo:{type:Number,required:!0,default:0},pv:{type:Number,default:0},bv:{type:Number,default:0},ibo:{type:Number,default:0},slug:{type:String,required:!0,default:"",unique:!0},tags:[{type:String,default:["",""]}],title:{type:String,required:!0},type:{type:String,default:""},sizes:{type:String,default:""}},{timestamps:!0});o.index({title:"text",tags:"text",slug:"text"});let i=r().models.Product||(0,n.model)("Product",o),s=i}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[271,444],()=>a(62390));module.exports=n})();