"use strict";(()=>{var e={};e.id=678,e.ids=[678],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},20195:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>v,originalPathname:()=>b,patchFetch:()=>h,requestAsyncStorage:()=>y,routeModule:()=>g,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>S});var n={};a.r(n),a.d(n,{DELETE:()=>m,GET:()=>u,POST:()=>l,PUT:()=>p});var r=a(10884),i=a(16132),o=a(21040),s=a(25999),d=a(31911),c=a(11185);async function u(){await s.db.connect();let e=await d.Z.find().sort({title:"asc"}).lean();return await s.db.disconnect(),Response.json(e)}async function l(e){let t=await e.json(),{id:a="",product:n="",productName:r="",productSlug:i="",productImage:o="",quantity:c=0,status:u="En proceso"}=t;await s.db.connect();let l=new d.Z({product:n,productName:r,productSlug:i,productImage:o,quantity:c,status:"En proceso"});try{s.rx.increaseProductQuantity(n,Number(c)),l.status="Completada",await l.save({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(l)}async function p(e){let t=await e.json(),{_id:a="",product:n="",productName:r="",productSlug:i="",productImage:o="",quantity:u=0,status:l=""}=t;if(!(0,c.isValidObjectId)(a))return console.log("Id de entrada incorrecto"),new Response("Id incorrecto",{status:400});await s.db.connect();let p=await d.Z.findById({_id:a});if(!p)return await s.db.disconnect(),console.log("El registro de entrada no existe"),new Response("El registro de entrada no existe",{status:400});if("Completada"!=p.status){p.product=n,p.quantity=Number(u),p.status="Completada",p.productImage=o,p.productName=r,p.productSlug=i;try{s.rx.increaseProductQuantity(n,Number(u)),await p.save({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(p)}}async function m(e){let t=await e.json();if(!(0,c.isValidObjectId)(t))return console.log("Id incorrecto"),new Response("Id de entrada incorrecto",{status:400});await s.db.connect();let a=await d.Z.findById({_id:t});if(!a)return await s.db.disconnect(),console.log("El registro de entrada no existe"),new Response("El registro de entrada no existe",{status:400});try{await a.deleteOne({validateBeforeSave:!0})}catch(e){return console.log(e),new Response("Error al enviar al servidor",{status:500})}return await s.db.disconnect(),Response.json(a)}let g=new r.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/entries/route",pathname:"/api/entries",filename:"route",bundlePath:"app/api/entries/route"},resolvedPagePath:"/Users/altice/RomApps/items-control/src/app/api/entries/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:y,staticGenerationAsyncStorage:w,serverHooks:f,headerHooks:v,staticGenerationBailout:S}=g,b="/api/entries/route";function h(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:w})}},25999:(e,t,a)=>{a.d(t,{db:()=>n,rx:()=>i,N2:()=>r});var n={};a.r(n),a.d(n,{connect:()=>c,disconnect:()=>u});var r={};a.r(r),a.d(r,{i:()=>m});var i={};a.r(i),a.d(i,{decreaseProductQuantity:()=>f,getAllProducts:()=>y,getProductBySlug:()=>w,increaseProductQuantity:()=>v});var o=a(11185),s=a.n(o);let d={isConnected:0},c=async()=>{if(!d.isConnected){if(s().connections.length>0){if(d.isConnected=s().connections[0].readyState,1===d.isConnected)return;await s().disconnect()}await s().connect(process.env.MONGO_URL||""),d.isConnected=1,console.log("Conectado a MongoDB:",process.env.MONGO_URL)}},u=async()=>{0!==d.isConnected&&(await s().disconnect(),d.isConnected=0)};var l=a(62421),p=a.n(l);let m={users:[{name:"Francisco Romano",email:"fromano@google.com",password:p().hashSync("123456"),role:"admin"},{name:"Betilio Romano",email:"bromano@google.com",password:p().hashSync("654321"),role:"client"}]};a(90644);var g=a(59471);let y=async()=>{await c();let e=await g.Z.find().select(" -_id").lean();await u();let t=e.map(e=>(e.images=e.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),e));return JSON.parse(JSON.stringify(t))},w=async e=>{await c();let t=await g.Z.findOne({slug:e}).lean();return(await u(),t)?(t.images=t.images.map(e=>e.includes("http")?e:`${process.env.HOST_NAME}/${e}`),JSON.parse(JSON.stringify(t))):null},f=async e=>{await c();try{e.map(async(e,t)=>{let a=await g.Z.findById({_id:e.product});a&&(a.inStock-=Number(e.quantity)),await a.save({validateBeforeSave:!0})})}catch(e){return console.log(e),new Response("Error al rebajar inventario",{status:500})}await u()},v=async(e,t)=>{await c();try{let a=await g.Z.findById({_id:e});a&&(a.inStock+=Number(t),await a.save({validateBeforeSave:!0}))}catch(e){return console.log(e),new Response("Error al incrementar inventario",{status:500})}await u()}},90644:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(11185),r=a.n(n);let i=new n.Schema({firstName:{type:String,required:!0,default:""},lastName:{type:String,required:!0,default:""},phone:{type:String,required:!0,default:""},email:{type:String,default:""}},{timestamps:!0});i.index({firstName:"text",email:"text"});let o=r().models.Customers||(0,n.model)("Customers",i),s=o},31911:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(11185),r=a.n(n);let i=new n.Schema({product:{type:String,required:!0,default:""},quantity:{type:Number,required:!0},status:{type:String},productName:{type:String,required:!0,default:""},productSlug:{type:String,required:!0,default:""},productImage:{type:String,required:!0,default:""}},{timestamps:!0}),o=r().models.Entry||(0,n.model)("Entry",i),s=o},59471:(e,t,a)=>{a.d(t,{Z:()=>s});var n=a(11185),r=a.n(n);let i=new n.Schema({description:{type:String,default:""},images:[{type:String}],default:["",""],inStock:{type:Number,default:0},costo:{type:Number,required:!0,default:0},pv:{type:Number,default:0},bv:{type:Number,default:0},ibo:{type:Number,default:0},slug:{type:String,required:!0,default:"",unique:!0},tags:[{type:String,default:["",""]}],title:{type:String,required:!0},type:{type:String,default:""},sizes:{type:String,default:""}},{timestamps:!0});i.index({title:"text",tags:"text",slug:"text"});let o=r().models.Product||(0,n.model)("Product",i),s=o}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[271,444],()=>a(20195));module.exports=n})();